}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
week5 <- proj
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(15*5, 20*5, 20*5, 20*5, 90))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
week5 <- proj
week6 <- proj
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(15*5, 20*5, 20*5, 20*5, 30))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
week7 <- proj
View(week5)
View(week6)
### Projection Function
projection <- function(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage){
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
}
View(games)
View(games[["Sep29"]])
View(games[["Sep28"]])
View(games[["Sep27"]])
### Projection Function
projection <- function(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage){
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
return(proj)
}
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week4 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
View(week4)
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week5 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
# 5 Practices (15,20,30,30) + 30, 0 scrimmage (15, ..., 60)
week6 <- projection(`Warm Up` = 15*5, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30)
library(tidyverse)
library(rlist)
library(lubridate)
library(DT)
library(shiny)
# Load in and Set Up Data
raw_names <- list.files("~/Desktop/BYUB/catapult/data/week4/") # Identify file names
split_names <- str_split(raw_names, c("_"))# Split file names
better_names <- c()  # Initialize vector
for (i in 1:length(raw_names)){ # Manipulate to format "MONDD")
better_names <- append(better_names, paste0(month.abb[as.numeric(split_names[[i]][2])] , split_names[[i]][3]))
}
games <- list()
for(i in 1:length(raw_names)) { # Read in data and add to list
games <- list.append(games,
read_csv(paste0("~/Desktop/BYUB/catapult/data/week4/",
raw_names[i]), skip = 9))
}
names(games) <- better_names # Change game names in list
#Selecting variables of interest
variables <- c("Player Name", "Period Name", "Player Load Per Minute", "Total Player Load", "Total Duration")
df <- data.frame(matrix(ncol=4, nrow=0))
for (i in 1:length(games)){
dl <- games[[i]]
dl <- dl %>%
select(variables)
df <- rbind(df, dl)
}
df <- df %>%
mutate(`Period Name` = ifelse(`Period Name` == "full court", "Drill Full", `Period Name`)) %>%
mutate(`Period Name` = ifelse(`Period Name` == "warmup", "Warm Up", `Period Name`))
df <- df %>%
group_by(`Player Name`, `Period Name`) %>%
summarize(
`Total Duration` = sum(`Total Duration`),
`Total Player Load` = sum(`Total Player Load`)
) %>%
ungroup()
df$`Player Load Per Minute` <- (df$`Total Player Load`/as.integer(df$`Total Duration`))*60
### Projection Function
projection <- function(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage){
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
return(proj)
}
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week5 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week6 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
# 5 Practices (15,20,30,30) + 30, 0 scrimmage (15, ..., 60)
week7 <- projection(`Warm Up` = 15*5, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30)
View(week5)
week5$week <- "Week 5"
week6$week <- "Week 6"
week7$week <- "Week 7"
combined_df <- bind_rows(week5, week6, week7)
View(combined_df)
combined_df %>%
filter(Period.Name == "Total")
combined_df <- bind_rows(week5, week6, week7)%>%
filter(Period.Name == "Total")
combined_df <- bind_rows(week5, week6, week7)%>%
filter(Period.Name == "Total") %>%
select(18, 3:17)
combined_df
combined_df
data_long <- data %>%
pivot_longer(cols = -Week, names_to = "Player", values_to = "Value")
data_long <- combined_df %>%
pivot_longer(cols = -Week, names_to = "Player", values_to = "Value")
data_long <- combined_df %>%
pivot_longer(cols = -week, names_to = "Player", values_to = "Value")
View(data_long)
View(df)
13109/60
View(week5)
combined_df <- bind_rows(week5, week6, week7)%>%
filter(Period.Name == "Total") %>%
select(18, 3:17) %>%
pivot_longer(cols = -week, names_to = "Player", values_to = "Value")
ggplot(combined_df, aes(x = Player, y = Value, fill = week)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Player Performance Over Weeks",
x = "Player",
y = "Value") +
theme_minimal()
ggplot(combined_df, aes(x = Player, y = Value, fill = week)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Player Performance Over Weeks",
x = "Player",
y = "Value") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(combined_df, aes(x = Player, y = Value, fill = week)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Player Load Projection",
x = "Player",
y = "Total Player Load") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot(combined_df, aes(x = Player, y = Value, fill = week)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Player Load History and Projection",
x = "Player",
y = "Total Player Load") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(week5)
105/15
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session")
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session") %>%
filter(`Period Name` != "Weight Room")
View(week4)
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session") %>%
filter(`Period Name` != "Weight Room") %>%
select(2,1,4)
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session") %>%
filter(`Period Name` != "Weight Room") %>%
select(2,1,4) %>%
group_by(`Player Name`) %>%
summarize(
`week` = "Week 4",
`Value` = sum(`Total Player Load`)
)
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session") %>%
filter(`Period Name` != "Weight Room") %>%
select(2,1,4) %>%
group_by(`Player Name`) %>%
summarize(
`week` = "Week 4",
`Value` = sum(`Total Player Load`)
) %>%
select(2,1,3)
colnames(week4)[2]
colnames(week4)[2] <- "Player"
library(tidyverse)
library(rlist)
library(lubridate)
library(DT)
library(shiny)
# Load in and Set Up Data
raw_names <- list.files("~/Desktop/BYUB/catapult/data/week4/") # Identify file names
split_names <- str_split(raw_names, c("_"))# Split file names
better_names <- c()  # Initialize vector
for (i in 1:length(raw_names)){ # Manipulate to format "MONDD")
better_names <- append(better_names, paste0(month.abb[as.numeric(split_names[[i]][2])] , split_names[[i]][3]))
}
games <- list()
for(i in 1:length(raw_names)) { # Read in data and add to list
games <- list.append(games,
read_csv(paste0("~/Desktop/BYUB/catapult/data/week4/",
raw_names[i]), skip = 9))
}
names(games) <- better_names # Change game names in list
#Selecting variables of interest
variables <- c("Player Name", "Period Name", "Player Load Per Minute", "Total Player Load", "Total Duration")
df <- data.frame(matrix(ncol=4, nrow=0))
for (i in 1:length(games)){
dl <- games[[i]]
dl <- dl %>%
select(variables)
df <- rbind(df, dl)
}
df <- df %>%
mutate(`Period Name` = ifelse(`Period Name` == "full court", "Drill Full", `Period Name`)) %>%
mutate(`Period Name` = ifelse(`Period Name` == "warmup", "Warm Up", `Period Name`))
df <- df %>%
group_by(`Player Name`, `Period Name`) %>%
summarize(
`Total Duration` = sum(`Total Duration`),
`Total Player Load` = sum(`Total Player Load`)
) %>%
ungroup()
df$`Player Load Per Minute` <- (df$`Total Player Load`/as.integer(df$`Total Duration`))*60
### Projection Function
projection <- function(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage){
players <- unique(df$`Player Name`)
proj <- data.frame("Period Name" = c("Warm Up", "Shooting", "Drill Full", "Drill Half", "Scrimmage"),
Duration = c(`Warm Up`, Shooting, `Drill Full`, `Drill Half`, Scrimmage))
for (player in players) {
proj[, player] <- NA
}
for (i in 1:length(players)){
for (j in 1:nrow(proj)){
proj[j,i+2] <- subset(df, `Player Name` == players[i] & `Period Name` == proj[j,1])[5]*proj[j,2]
}
}
proj <- proj %>%
bind_rows(summarise(., across(where(is.numeric), sum),
across(where(is.character), ~'Total')))
proj[, -1] <- round(proj[, -1])
return(proj)
}
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week5 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
# 5 Practices (15,20,30,30) + 30, 1 scrimmage (15, ..., 60)
week6 <- projection(`Warm Up` = 15*6, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30 + 60)
# 5 Practices (15,20,30,30) + 30, 0 scrimmage (15, ..., 60)
week7 <- projection(`Warm Up` = 15*5, Shooting = 20*5, `Drill Full` = 30*5,`Drill Half` = 30*5, Scrimmage = 30)
# Adding in week 4
week4 <- df %>%
filter(`Period Name` != "Session") %>%
filter(`Period Name` != "Weight Room") %>%
select(2,1,4) %>%
group_by(`Player Name`) %>%
summarize(
`week` = "Week 4",
`Value` = sum(`Total Player Load`)
) %>%
select(2,1,3)
colnames(week4)[2] <- "Player"
week5$week <- "Week 5"
week6$week <- "Week 6"
week7$week <- "Week 7"
combined_df <- bind_rows(week4,week5, week6, week7)%>%
filter(Period.Name == "Total") %>%
select(18, 3:17) %>%
pivot_longer(cols = -week, names_to = "Player", values_to = "Value")
combined_df <- bind_rows(week5, week6, week7)%>%
filter(Period.Name == "Total") %>%
select(18, 3:17) %>%
pivot_longer(cols = -week, names_to = "Player", values_to = "Value")
View(combined_df)
cbind(week4, combined_df)
rbind(week4, combined_df)
combined_df <- rbind(week4, combined_df)
ggplot(combined_df, aes(x = Player, y = Value, fill = week)) +
geom_bar(stat = "identity", position = "dodge") +
labs(title = "Player Load History and Projection",
x = "Player",
y = "Total Player Load") +
theme_minimal()+
theme(axis.text.x = element_text(angle = 45, hjust = 1))
View(week4)
View(df)
13109/60
13109/60/7
9602/60/7
4732/60/7
7145/60/7
3775/60/7
# Loading Packages
library(tidyverse)
library(tidymodels)
library(vroom)
library(poissonreg)
library(rpart)
library(ranger)
library(stacks)
library(embed)
# Reading in Data
setwd("~/Desktop/Stat348/AmazonEmployeeAccess/")
train <- vroom("train.csv")
test <- vroom("test.csv")
train$ACTION <- as.factor(train$ACTION)
my_recipe <- recipe(ACTION ~ ., data = train) %>%
step_mutate_at(all_numeric_predictors(), fn = factor) %>% # turn all numeric features into factors
step_other(all_factor_predictors(), threshold = .005) %>% # combines categorical values that occur <5% into an "other" value
step_dummy(all_nominal_predictors()) # dummy variable encoding
bake(prep(my_recipe), new_data = train)
penlog_mod <- logistic_reg(mixture=tune(), penalty=tune()) %>% #Type of model
set_engine("glmnet")
penlog_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(penlog_mod)
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 5)
folds <- vfold_cv(train, v = 5, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc, f_meas, sens, recall, spec,
precision, accuracy)) #Or leave metrics NULL
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_wf
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 5)
folds <- vfold_cv(train, v = 2, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_final_wf <- penlog_wf %>%
finalize_workflow(penlog_bestTune) %>%
fit(data = train)
penlog_preds <- predict(penlog_final_wf,
new_data=test,
type="prob")
View(penlog_preds)
penlog_submit <- as.data.frame(cbind(test$id, penlog_preds$.pred_1))
colnames(penlog_submit) <- c("id", "ACTION")
write_csv(penlog_submit, "penlog_submit.csv")
my_recipe <- recipe(ACTION ~ ., data = train) %>%
step_mutate_at(all_numeric_predictors(), fn = factor) %>% # turn all numeric features into factors
#step_other(all_factor_predictors(), threshold = .005) %>% # combines categorical values that occur <5% into an "other" value
#step_dummy(all_nominal_predictors()) # dummy variable encoding
step_lencode_mixed(all_nominal_predictors(), outcome = vars(ACTION))  #target encoding
bake(prep(my_recipe), new_data = train)
penlog_mod <- logistic_reg(mixture=tune(), penalty=tune()) %>% #Type of model
set_engine("glmnet")
penlog_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(penlog_mod)
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 5)
folds <- vfold_cv(train, v = 2, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))#, f_meas, sens, recall, spec,precision, accuracy)) #Or leave metrics NULL
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_final_wf <- penlog_wf %>%
finalize_workflow(penlog_bestTune) %>%
fit(data = train)
penlog_preds <- predict(penlog_final_wf,
new_data=test,
type="prob")
penlog_submit <- as.data.frame(cbind(test$id, penlog_preds$.pred_1))
colnames(penlog_submit) <- c("id", "ACTION")
write_csv(penlog_submit, "penlog_submit.csv")
penlog_mod <- logistic_reg(mixture=tune(), penalty=tune()) %>% #Type of model
set_engine("glmnet")
penlog_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(penlog_mod)
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 5)
folds <- vfold_cv(train, v = 5, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))#, f_meas, sens, recall, spec,precision, accuracy)) #Or leave metrics NULL
penlog_mod <- logistic_reg(mixture=tune(), penalty=tune()) %>% #Type of model
set_engine("glmnet")
penlog_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(penlog_mod)
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 10)
folds <- vfold_cv(train, v = 5, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))#, f_meas, sens, recall, spec,precision, accuracy)) #Or leave metrics NULL
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_final_wf <- penlog_wf %>%
finalize_workflow(penlog_bestTune) %>%
fit(data = train)
penlog_preds <- predict(penlog_final_wf,
new_data=test,
type="prob")
penlog_submit <- as.data.frame(cbind(test$id, penlog_preds$.pred_1))
colnames(penlog_submit) <- c("id", "ACTION")
write_csv(penlog_submit, "penlog_submit.csv")
View(penlog_bestTune)
penlog_mod <- logistic_reg(mixture=tune(), penalty=tune()) %>% #Type of model
set_engine("glmnet")
penlog_wf <- workflow() %>%
add_recipe(my_recipe) %>%
add_model(penlog_mod)
penlog_tuning_grid <- grid_regular(penalty(),
mixture(),
levels = 50)
folds <- vfold_cv(train, v = 10, repeats=1)
penlog_cv <- penlog_wf %>%
tune_grid(resamples = folds,
grid = penlog_tuning_grid,
metrics = metric_set(roc_auc))#, f_meas, sens, recall, spec,precision, accuracy)) #Or leave metrics NULL
penlog_bestTune <- penlog_cv %>%
select_best("roc_auc")
penlog_final_wf <- penlog_wf %>%
finalize_workflow(penlog_bestTune) %>%
fit(data = train)
penlog_preds <- predict(penlog_final_wf,
new_data=test,
type="prob")
penlog_submit <- as.data.frame(cbind(test$id, penlog_preds$.pred_1))
colnames(penlog_submit) <- c("id", "ACTION")
write_csv(penlog_submit, "penlog_submit.csv")
View(penlog_bestTune)
